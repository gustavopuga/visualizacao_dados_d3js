<!-- BASED ON https://www.d3-graph-gallery.com/ -->
<!DOCTYPE html>
<html>

<head>
    <style>
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.15.0/d3.min.js"></script>
    <title>Teste TreeMap</title>
</head>

<body>

    <h1>Teste TreeMap</h1>
    <p id="graph"></p>

    <script>


        // set the dimensions and margins of the graph
        var margin = { top: 10, right: 10, bottom: 10, left: 10 },
            width = 445 - margin.left - margin.right,
            height = 445 - margin.top - margin.bottom;

        // append the svg object to the body of the page
        var svg = d3.select("#graph")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

        // read csv data
        d3.json("https://raw.githubusercontent.com/gustavopuga/visualizacao_dados_d3js/master/datasets/corona.json").then(function (data) {

            // Give the data to this cluster layout:
            var root = d3.hierarchy(data).sum(function (d) { return d }) // Here the size of each leave is given in the 'value' field in input data
console.info(root);
            // Then d3.treemap computes the position of each element of the hierarchy
            d3.treemap()
                .size([width, height])
                .paddingTop(28)
                .paddingRight(7)
                .paddingInner(3)      // Padding between each rectangle
                //.paddingOuter(6)
                //.padding(20)
                (root)

            // prepare a color scale
            var color = d3.scaleOrdinal()
                .domain(["Norte", "Nordeste", "Sudeste", "Sul", "Centro-Oeste"])
                .range(["#2ecc71", "#e74c3c", "#9b59b6", "3498db", "e67e22"])

            // And a opacity scale
            var opacity = d3.scaleLinear()
                .domain([10, 30])
                .range([.5, 1])

            // use this information to add rectangles:
            svg
                .selectAll("rect")
                .data(root.leaves())
                .enter()
                .append("rect")
                .attr('x', function (d) { return d.x0; })
                .attr('y', function (d) { return d.y0; })
                .attr('width', function (d) { return d.x1 - d.x0; })
                .attr('height', function (d) { return d.y1 - d.y0; })
                .style("stroke", "black")
                .style("fill", function (d) { console.info (d.data); return color(d.parent.data.estado) })
                .style("opacity", function (d) { return 1 })

            // and to add the text labels
            svg
                .selectAll("text")
                .data(root.leaves())
                .enter()
                .append("text")
                .attr("x", function (d) { return d.x0 + 5 })    // +10 to adjust position (more right)
                .attr("y", function (d) { return d.y0 + 20 })    // +20 to adjust position (lower)
                .text(function (d) { return d.data.estado })
                .attr("font-size", "19px")
                .attr("fill", "white")

            // and to add the text labels
            svg
                .selectAll("vals")
                .data(root.leaves())
                .enter()
                .append("text")
                .attr("x", function (d) { return d.x0 + 5 })    // +10 to adjust position (more right)
                .attr("y", function (d) { return d.y0 + 35 })    // +20 to adjust position (lower)
                .text(function (d) { return d.data.casosAcumulados })
                .attr("font-size", "11px")
                .attr("fill", "white")

            // Add title for the 3 groups
            // svg
            //     .selectAll("titles")
            //     .data(root.descendants().filter(function (d) { return d.depth == 1 }))
            //     .enter()
            //     .append("text")
            //     .attr("x", function (d) { return d.x0 })
            //     .attr("y", function (d) { return d.y0 + 21 })
            //     .text(function (d) { console.info(d); return d.data.name })
            //     .attr("font-size", "19px")
                .attr("fill", function (d) { return color(d.data.name) })

            // Add title for the 3 groups
            svg
                .append("text")
                .attr("x", 0)
                .attr("y", 14)    // +20 to adjust position (lower)
                .text("Three group leaders and 14 employees")
                .attr("font-size", "19px")
                .attr("fill", "grey")

        })

    </script>

</body>

</html>